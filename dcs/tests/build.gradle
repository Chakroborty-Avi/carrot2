
apply plugin: 'java'
apply plugin: 'java-test-fixtures'

configurations {
  distribution
}

dependencies {
  distribution project(path: ":dcs:distribution", configuration: "distDir")

  testImplementation project(":dcs:examples")
  testImplementation project(":dcs:model")
  testImplementation libs.jackson.databind

  testFixturesApi project(':infra:tests')
  testFixturesApi project(":dcs:distribution")
  testFixturesApi libs.carrotsearch.procfork
  testFixturesApi libs.carrotsearch.console.launcher
  testFixturesApi libs.jetty.server
  testFixturesApi libs.jetty.webapp
}

test {
  dependsOn configurations.distribution
  maxParallelForks = 1

  doFirst {
    systemProperty "dist", "${configurations.distribution.singleFile}"
  }
}
